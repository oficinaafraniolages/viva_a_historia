var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}define("platformInit/utils/dataGetters/serviceTopologyDataGetter",["lodash"],function(e){"use strict";return{serviceTopology:function(t,r){var n=r.serviceTopology;return e.get(n,t)}}}),define("platformInit/utils/dataGetters/clientSpecDataGetter",["lodash"],function(e){"use strict";return{clientSpec:function(t,r){var n=r.clientSpec;return e.get(n,t)}}}),define("platformInit/utils/dataGetters/dataGetters",["lodash","platformInit/utils/dataGetters/serviceTopologyDataGetter","platformInit/utils/dataGetters/clientSpecDataGetter"],function(e){"use strict";var t=e.drop(arguments,1);return e.assign.apply(e,[{}].concat(_toConsumableArray(t)))}),define("platformInit/utils/urlResolver",["lodash","platformInit/utils/dataGetters/dataGetters"],function(e,t){"use strict";var r=/{urlTemplate:(.*)}/,n=function(r,n){return e.reduce(t,function(r,i,o){return function(r,n,i){var o=new RegExp("{"+i+":(.*?)}","g");return r.replace(o,function(r,o){var a=t[i](o,n);if(e.isUndefined(a))throw new Error("Data getter '"+i+"' returned no value for data '"+o+"'");return a})}(r,n,o)},r)};return{resolve:function(t,i){var o=r.exec(t)||[],a=_slicedToArray(o,2)[1];return e.isUndefined(a)?t:n(a,i)}}}),define("platformInit/utils/specMapUtils",["lodash","platformInit/utils/urlResolver"],function(e,t){"use strict";return{getAppSpec:function(t,r){return e.find(t,{appDefinitionId:r})||e.find(t,{type:"siteextension"})},resolveEditorScriptUrl:function(r,n){var i=e.get(r,["appFields","platform"]);if(!e.isUndefined(i)){var o=i.editorScriptUrl;if(!e.isUndefined(o)){var a=t.resolve(o,n);return e.merge({},r,{appFields:{platform:{editorScriptUrl:a}}})}}return r},resolveUrl:t.resolve}}),define("platformInit/utils/appsUtils",["lodash","experiment","platformInit/utils/specMapUtils"],function(e,t,r){"use strict";var n="1380b703-ce81-ff05-f115-39571d94dfcd",i="675bbcef-18d8-41f5-800e-131ec9e08762";function o(t,r,n){if(t){var i,o,a=(i=t,o=n,e(o).map(function(e){return i.getDynamicPageData(e)}).find());if(a){var s=a.routerData,l=a.routerDefinition;if(s&&l){if("wix-code"===l.appDefinitionId)e.forEach(n,function(t){e.forEach(r,function(e){e.id===t&&(e.routerData=s)})});else{var u=e.find(r,{id:l.appDefinitionId});u&&(u.routerData=s)}}}}}function a(t){return e(t).reject({displayName:"siteextension"}).map(function(t){return e.assign({type:s.APPLICATION},t)}).value()}var s={POPUP:"Popup",PAGE:"Page",MASTER_PAGE:"masterPage",APPLICATION:"Application"};function l(t){return!!e.get(t,["wixCodeModel","appData","codeAppId"])}function u(t,r,n){t=e.without(t,"masterPage");var i=a(n);return function(t,r,n,i,o){if(l(i.rendererModel)&&e.find(t,r)){var a=i.isPlatformAppOnPage("masterPage","wixCode");e.forEach(n,function(t){var r=i.isPlatformAppOnPage(t,"wixCode"),n=i.getDataByQuery(t),l=e.get(n,"isPopup");r&&o.push({id:t,type:l?s.POPUP:s.PAGE,displayName:i.getPageTitle(t)}),!l&&a&&o.push({id:t,type:s.MASTER_PAGE})})}}(n,{displayName:"siteextension"},t,r,i),o(r,i,t),i}function c(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function p(t,r,n,i){if(l(i)&&e.find(t,{type:"siteextension"})&&!e.find(t,{appDefinitionId:"dataBinding"})){var o=function(e,t,r){var n=c(e.scriptsDomainUrl,"services",t);return r?c(n,r):e.scriptsLocationMap[t]}(r,"dbsm-viewer-app",n.dataBinding);return e.assign({},t,{fakeApplicationId:{appDefinitionId:"dataBinding",appFields:{platform:{viewerScriptUrl:c(o,"/app.js"),viewerVerboseScriptUrl:c(o,"/app.verbose.js")}},type:s.APPLICATION}})}return t}function d(o,a,s){return e(o).filter(function(r){return!(r.appDefinitionId===n&&!t.isOpen("sv_ecomViewerScriptUrl",{rendererModel:a}))&&(r.appDefinitionId===i?l(a):(o=r,e.has(o,"appFields.platform.viewerScriptUrl")));var o}).map(function(n){var i=e.pickBy({id:n.appDefinitionId,displayName:n.type,appInnerId:n.applicationId,instance:n.instance}),o=function(r,n){var i=e.get(r,"appFields.platform.viewerScriptUrl"),o=e.get(r,"appFields.platform.viewerVerboseScriptUrl");return t.isOpen("wixCodeVerboseMode")&&n&&o?o:i}(n,a.previewMode);return o&&(i.url=r.resolveUrl(o,{serviceTopology:s,clientSpec:n})),i}).value()}function f(t){var r,n=(r=t.viewerPlatformAppSources,e(r||"").split(",").invokeMap("split",/:(.+)/).fromPairs().value()),i=d(p(t.clientSpecMap,t.serviceTopology,n,t.rendererModel),t.rendererModel,t.serviceTopology);return function(t,r,n){if(e.get(t,"port")&&e.get(t,"path")&&e.get(t,"id")){n=e.endsWith(n,"/")?n.slice(0,-1):n;var i=e.template("<%= santaBase %><%= port %>/<%= path %>"),o=void 0;o=/^(http(s)?:)?\/\//.test(t.path)?t.path:"80"===t.port?i({santaBase:n,port:"",path:t.path}):i({santaBase:n,port:":"+t.port,path:t.path}),r.push({type:s.APPLICATION,id:t.id,url:o,displayName:t.id})}}(n,i,t.santaBase),i}function g(t,r,n){return u(r,n,f({clientSpecMap:t,viewerPlatformAppSources:e.get(n,["currentUrl","query","viewerPlatformAppSources"]),serviceTopology:n.serviceTopology,santaBase:n.santaBase,rendererModel:n.rendererModel}))}function m(r,i,o){return"platform.components.AppController"===r.componentType||"platform.components.AppWidget"===r.componentType||function(r,i,o){if(!v(r.componentType))return!1;var a=r.dataQuery.replace("#",""),s=i.getDataByQuery(a,o.id),l=i.getClientSpecMapEntry(s.applicationId);if(e.get(l,"appDefinitionId")===n&&!t.isOpen("sv_ecomViewerScriptUrl",i))return!1;return e.get(l,"appFields.platform.viewerScriptUrl")}(r,i,o)}function v(e){return["wysiwyg.viewer.components.tpapps.TPAMultiSection","wysiwyg.viewer.components.tpapps.TPASection","wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAWidget"].includes(e)}function y(t,r){var n,i,o=e.filter(t,"json"),a=(n=e.map(o,"json"),i=r,e(n).transform(function(t,r){e.assign(t,e.get(r,"data.connections_data"))},{}).values().flatMap(function(t){var r=i.resolveData(t,null,i.dataTypes.CONNECTIONS);return e.get(r,"items")}).groupBy("controllerId").value());return e.flatMap(o,function(t){var n=e.filter(e.get(t,"json.structure.DESKTOP"),function(e){return m(e,r,t)});return e.map(n,function(n){var i=n.dataQuery.replace("#",""),o=r.getDataByQuery(i,t.id);return v(n.componentType)&&(o.controllerType=function(t,r){var n=r.getClientSpecMapEntry(t.applicationId);return n?t.widgetId||e.findKey(n.widgets,["appPage.hidden",!1]):null}(o,r),o.settings={compId:n.id}),e.omitBy({controllerBehaviors:e.get(r.getDataByQuery(n.behaviorQuery,t.id,r.dataTypes.BEHAVIORS),"items",[]),controllerData:o,controllerId:i,compId:n.id,connections:e.get(a,i),dependencies:function(t,r,n){var i=n.getDataByQuery(t.connectionQuery,r.id,n.dataTypes.CONNECTIONS);return i?e(i.items).filter({type:"ConnectionItem"}).map("controllerId").value():[]}(n,t,r)},e.isUndefined)})})}return{getApplications:g,getUserCodeDefinitions:function(t,r,n){return e.reject(g(t,r,n),{type:s.APPLICATION})},getAppsBaseInfo:function(t){var r=f(t);return e.filter(a(r),"url")},getContextInitData:function(t,r){var n=y(function(t,r){var n=[{id:t,json:r.getPageData(t)}];if(e.get(r.getDataByQuery(t),"isPopup"))return n;var i=r.MASTER_PAGE_ID;return n.concat({id:i,json:r.getMasterPageData()})}(r,t),t);return e.mapValues(e(n).groupBy("controllerData.applicationId").mapValues(function(t){return e(t).keyBy("controllerId").mapValues(function(t){return e.pick(t,["controllerData","controllerBehaviors","connections","compId","dependencies"])}).value()}).value(),function(e){return{controllers:e}})}}}),define("platformInit/utils/widgetsPreLoader",["platformInit/utils/appsUtils","lodash"],function(e,t){"use strict";var r=null,n=null,i=null,o=[];function a(e,a,u,c){if(l())return o.push([e,a,u,c]),void requirejs(["utils","widgets","wixCode"],s);var p=c(r);p.currentUrl=r.urlUtils.parseUrl(e);var d=r.wixUrlParser.parseUrl(p,e),f=d&&d.pageId;if(f&&!t.includes(t.get(p,"publicModel.siteMembersProtectedPages"),f)){var g=a(n,p,f),m=i.wixCodeWidgetService.getWixCodeSpec(p.getClientSpecMap());u(i.messageBuilder.getExtendedMessage(g,p.rendererModel.wixCodeModel||{},m,p))}}function s(e,t,s){l()&&(r=e,n=t,i=s,o.forEach(function(e){return a.apply(void 0,_toConsumableArray(e))}),o.length=0)}function l(){return!r||!n||!i}return{asyncGetPreLoadMessage:function(t,r,n){a(r,function(r,n,i){var o=e.getApplications(t.rendererModel.clientSpecMap,[i],n),a=t.routers||{configMap:{}},s=r.modelBuilderDataHelper.getApi(n),l=r.globalsBuilder.build(s,!0,i);return r.messageBuilder.loadWidgetsMessage(o,a.configMap,[i],void 0,_defineProperty({},i,l.toJson()))},n,function(e){return new e.FullSiteData(t,function(){})})},asyncGetPreLoadUserCodeMessage:function(t,r,n){a(r,function(r,n,i){var o=e.getUserCodeDefinitions(t.rendererModel.clientSpecMap,[i],n);return r.messageBuilder.loadUserCodesMessage(o,[i])},n,function(e){return new e.FullSiteData(t,function(){})})},asyncGetPreInitMessage:function(t,r,n){a(r,function(t,r,n){var i={};return i[n]=e.getContextInitData(r,n),t.messageBuilder.initWidgetsMessage(i)},n,function(){return t})},registerDeps:s}}),define("platformInit/utils/constants",[],function(){"use strict";return{APPS:{SANTA_MEMBERS:{appDefId:"14cc59bc-f0b7-15b8-e1c7-89ce41d0e0c9"},FORM_BUILDER:{appDefId:"14ce1214-b278-a7e4-1373-00cebd1bef7c"}},WIX_CODE_NAMESPACES_AND_ELEMENTORY_SUPPORT_PATH:"/wixCodeNamespacesAndElementorySupport.min.js",DATA_BINDING:"dataBinding",REMOTE_DOM_URL:"//unpkg.parastorage.com/@shimil/remote-dom@3.0.3/dist/remote.min.js",SEMI_NATIVE_SDK_URL:"http://static.parastorage.com/services/semi-native-sdk/1.3.0/lib/wix.min.js",PM_RPC_INTENTS:{INVOKE:"invoke",RPC_RESOLVE:"rpc-resolve",RPC_REJECT:"rpc-reject",API_DESCRIPTION:"api-desc",INVOKE_FUNCTION:"invoke-func",RESOLVE:"resolve",REJECT:"reject",REQUEST_API:"request-api"}}}),define("platformInit/utils/cookieUtils",[],function(){"use strict";return{getCookie:function(e){if("undefined"!=typeof document)return function(e){for(var t={},r=e.split(/;\s*/),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[o[0]]=o[1]}return t}(window.document.cookie)[e]}}}),define("platformInit/utils/wixCodeUrlUtils",["lodash","platformInit/utils/cookieUtils"],function(e,t){"use strict";function r(e){var t=e.appConfig.userScript;return{id:e.id,url:t.url,scriptName:t.scriptName,displayName:t.displayName,routerData:e.routerData}}return{getUserCodeUrlsDetails:function(t,n){var i=[],o=e.find(t,function(e){return e.id===n&&"masterPage"!==e.type}),a=e.find(t,{id:n,type:"masterPage"});return a&&i.push(r(a)),o&&i.push(r(o)),i},getElementoryArguments:function(r,n,i,o){var a,s=(a=i,e(a).map("appConfig").find());if(s)return{baseUrl:(l=r,u=n,l.publicModel?e.trimEnd(l.publicModel.externalBaseUrl,"/")+"/_api/wix-code-public-dispatcher/siteview":"//"+e.find(u,{type:"siteextension"}).instanceId+".dev."+l.serviceTopology.wixCloudBaseDomain),queryParameters:(c={scari:s.scari,instance:s.instance,viewMode:o},e.reduce(c,function(t,r,n){return e.isUndefined(r)?t:t.concat([n+"="+r])},[]).join("&")),options:{headers:{"X-XSRF-TOKEN":t.getCookie("XSRF-TOKEN")}}};var l,u;var c}}}),define("platformInit/utils/urlBuilder",["lodash"],function(e){"use strict";function t(e){return e&&e.replace(/^https?\:/,"")}function r(r,n){var i=t(r);if(e.startsWith(i,n)){var o=i.slice(n.length).match(/\/?services\/santa\/([\w.]+)/);return o&&o[1]}}return{buildUrl:function(e,n){var i=n.runtimeSource,o=e.serviceTopology,a=function(e,n,i,o){if(e)return e;var a=t(o);return r(n,a)||r(i,a)}(i,e.santaBase,o.scriptsLocationMap.santa,o.scriptsDomainUrl),s="/node_modules/santa-wix-code/dist/wixcode-worker.js";return l=o.scriptsLocationMap.santa,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(l)?s:"/_partials/santa/"+a+s;var l}}}),define("platformInit/utils/FallbackStorage",[],function(){"use strict";return function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"setItem",value:function(e,t){this[e]=String(t)}},{key:"getItem",value:function(e){return this[e]||null}},{key:"removeItem",value:function(e){delete this[e]}},{key:"clear",value:function(){var e=this;Object.keys(this).forEach(function(t){return e.removeItem(t)})}},{key:"toJSON",value:function(){return this.storage.toJSON()}}]),e}()}),define("platformInit/utils/storageFacade",["lodash","platformInit/utils/FallbackStorage"],function(e,t){"use strict";var r="platform_app_";function n(t){var n={},i=Object.keys(t).filter(function(t){return"string"==typeof t&&e.startsWith(t,r)}),o=!0,a=!1,s=void 0;try{for(var l,u=i[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value;n[c.replace(r,"")]=t.getItem(c)}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}return n}return{get:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?window:{localStorage:new t,sessionStorage:new t};return{serialize:function(){return JSON.stringify({local:n(e.localStorage),session:n(e.sessionStorage)})},setItem:function(t,n,i){e[t].setItem(r+n,i)}}}}}),define("platformInit/utils/messageBuilder",[],function(){"use strict";return{bootstrapMessage:function(e,t){return{type:"wix_code_worker_bootstrap",bootstrapArguments:e,fetchScriptsCount:t}},loadUserCodeMessage:function(e,t){return{type:"wix_code_worker_load_user_code",workerId:e,wixCode:t}},loadMessage:function(e,t,r,n,i,o,a,s,l){return{type:"wix_code_worker_load",workerId:e,elementoryArguments:t,wixCode:r,applications:n,sdkParameters:i,routersMap:o,lightboxContext:a,storage:s,rgi:l}},initMessage:function(e,t){return{type:"wix_code_worker_init",id:e,apps:t}},startMessage:function(e,t,r){return{type:"wix_code_worker_start",context:e,id:t,siteInfo:r}},storageWasUpdatedMessage:function(e){return{type:"storageWasUpdated",storageValue:e}},updateWixCodeModelDataAfterLoginMessage:function(e,t){return{type:"update_wix_code_model_data_after_login",workerId:e,elementoryArguments:t}},scriptImportMessage:function(e,t){return{type:"script_import_message",url:e,script:t}},stopMessage:function(e){return{contextId:e,type:"stop"}},isStopMessage:function(e){return"stop"===e.type}}}),define("platformInit/api/workerManager",["lodash","platformInit/utils/constants","platformInit/utils/wixCodeUrlUtils","platformInit/utils/urlBuilder","platformInit/utils/storageFacade","platformInit/utils/messageBuilder"],function(e,t,r,n,i,o){"use strict";function a(e){return e.publicModel?"site":"preview"}function s(t,r,n){var i=0;"undefined"!=typeof window&&(n=n&&window.fetch&&(a=window,!(a.navigator&&/Edge|Trident/.test(a.navigator.userAgent))),e.forEach(t,function(t){if(n&&e.includes(t.url,"parastorage"))++i,window.fetch(t.url).then(function(e){return e.arrayBuffer()}).then(function(e){r.postMessage(o.scriptImportMessage(t.url,e),[e])});else{var a="prefetch-"+t.id;if(!window.document.getElementById(a)){var s=window.document.createElement("link");s.setAttribute("rel","prefetch"),s.setAttribute("href",t.url),s.setAttribute("id",a),window.document.head.appendChild(s)}}}));var a;return i}function l(r){if(!this._standbyWorker){var i=new window.Worker(n.buildUrl(this._siteModel,this._options));i.addEventListener("message",this.onmessage),this._standbyWorker=i,function(r){var n=this._options.applications,i={id:"wixCodeNamespacesAndElementorySupport",url:this._siteModel.serviceTopology.scriptsLocationMap["wix-code-platform"]+t.WIX_CODE_NAMESPACES_AND_ELEMENTORY_SUPPORT_PATH},l={id:"sdk",url:this._options.sdkSource},u={id:"namespaces-sdk",url:this._options.namespacesSdkSource},c={id:"external-components",url:this._options.externalComponentsSource},p=s(function(r,n,i){var o=e.clone(r);return n.some(function(e){return e.id===t.DATA_BINDING})&&(o=o.concat(i)),o.concat(n)}([l,u,c],n,i),this._standbyWorker,r);this._standbyWorker.postMessage(o.bootstrapMessage({sdkParameters:function(){var e="undefined"!=typeof window&&!window.clientSideRender,t="undefined"==typeof window||window.isPseudoWindow;return{viewMode:a(this._siteModel),locale:this._siteModel.rendererModel.languageCode,storage:this._storageManager.serialize(),userWarmup:this._siteModel.userWarmup,renderCycle:e&&!t?2:1,renderingEnv:t?"backend":"browser"}}.call(this),debug:window.__WIX_CODE_DEBUG__,santaVersion:this._siteModel.baseVersion,wixCodeBase:this._siteModel.santaBase+"/node_modules/santa-wix-code",sdkSource:l.url,namespacesSdkSource:u.url,externalComponentsSource:c.url,applications:JSON.stringify(n),wixCodeNamespacesAndElementorySupportScript:i,initialTimestamp:this._siteModel.wixBiSession.initialTimestamp,metaSiteId:this._siteModel.rendererModel.metaSiteId,openExperiments:(d=this._siteModel.rendererModel.runningExperiments,e.reduce(d,function(e,t,r){return"new"===t&&e.push(r),e},[]))},p));var d}.call(this,!!r)}}function u(e){this._workers[e]=this._standbyWorker,this._reportWorkerCreated(e),this._standbyWorker=null}function c(t,n){return t.reduce(function(t,i){return e.assign(t,_defineProperty({},i,r.getUserCodeUrlsDetails(n,i)))},{})}function p(t){var r=this;return function(n){var i=n.data;e.isMatch(i,{intent:"BROWSER_API",type:"setToStorage"})&&function(t){var r=this,n=t.type,i=t.key,a=t.value;this._storageManager.setItem(n,i,a);var s=o.storageWasUpdatedMessage(this._storageManager.serialize());e.forEach(this._workers,function(e,t){r.send(t,s)})}.call(r,i.data),t(n)}}var d=function(){function n(e,t,r,i){_classCallCheck(this,n),this._siteModel=e,this._clientSpecMap=t,this._options=i,this._workers={},this._terminatedWorkers={},this._standbyWorker=null,this._storageManager=r}return _createClass(n,[{key:"has",value:function(e){return Boolean(this._workers[e])}},{key:"initialize",value:function(r,n,i,o){this.onmessage=function(r){return function(n){var i=n.data,o=n.ports;e.includes(t.PM_RPC_INTENTS,i.intent)&&window.postMessage(i,"*",o),r(n)}}.call(this,p.call(this,function(e){var t=e.data;return r(t)})),this._reportWorkerCreated=n,this._reportWorkerTerminated=i,l.call(this,o)}},{key:"send",value:function(e,t,r){var n=o.isStopMessage(t)?this._terminatedWorkers[e]:this._workers[e];n&&(r?n.postMessage(t,r):n.postMessage(t))}},{key:"get",value:function(e){return this._workers[e]}},{key:"handleWidgetsCommand",value:function(t,n){var i=this;switch(t.type){case"load_user_code":(function(e){var t=this;Object.keys(e).forEach(function(r){var n=e[r];s(n),t.has(r)||(l.call(t),u.call(t,r)),t.send(r,o.loadUserCodeMessage(r,n))})}).call(this,c(t.rootIds,t.widgets));break;case"load_widgets":(function(e){var t=this,r=e.applications,n=e.rootIds,i=e.wixCodeScriptsByRootId,a=e.elementoryArguments,s=e.popupContexts,c=e.routersMap,p=e.sdkParameters,d=e.rgisByRootId;n.forEach(function(e){t.has(e)||(l.call(t),u.call(t,e)),t.send(e,o.loadMessage(e,a,i[e],r,p,c,s[e],t._storageManager.serialize(),d[e]))})}).call(this,{applications:e.reject(t.widgets,e.overSome({type:"Page"},{type:"Popup"},{type:"masterPage"})),rootIds:t.rootIds,wixCodeScriptsByRootId:c(t.rootIds,t.widgets),elementoryArguments:r.getElementoryArguments(this._siteModel,this._clientSpecMap,t.widgets,a(this._siteModel)),popupContexts:t.popupContexts,routersMap:t.routersMap,sdkParameters:t.sdkParameters,rgisByRootId:t.rgisByRootId});break;case"init_widgets":e.forEach(t.contexts,function(e,t){if(!i.has(t))throw new Error("Context id "+t+" is not loaded");i.send(t,o.initMessage(t,e))});break;case"start_widgets":if(!t.contexts)throw new Error("Start message must contain contexts property");e.forEach(t.contexts,function(e,r){if(!i.has(r))throw new Error("Context id "+r+" is not loaded");i.send(r,o.startMessage(e,r,t.siteInfo))});break;case"trigger_onRender":l.call(this),this.send(t.contextId,t);break;case"stop_widgets":e.forEach(t.widgetIds,function(t){(function(t){var r=this,n=this._workers[t];return!!n&&(delete this._workers[t],this._terminatedWorkers[t]=n,e.defer(function(){r.send(t,o.stopMessage(t)),delete r._terminatedWorkers[t]}),!0)}).call(i,t)&&i._reportWorkerTerminated(t)});break;case"update_wix_code_model_data_after_login":e.forEach(t.rootIds,function(e){i.send(e,o.updateWixCodeModelDataAfterLoginMessage(e,r.getElementoryArguments(i._siteModel,i._clientSpecMap,t.widgets,a(i._siteModel))))});break;default:this.has(t.contextId)&&this.send(t.contextId,t,n)}}},{key:"terminateStandbyWorker",value:function(){this._standbyWorker&&(this._standbyWorker.terminate(),this._standbyWorker=null)}}]),n}();return{getWorkerManager:function(e,t,r,n){return new d(e,t,i.get(r),n)}}}),define("platformInit/utils/messageProxy",[],function(){"use strict";return{get:function(){var e=[],t=null;return{sendOrHoldMessage:function(r,n){t?t(r,n):e.push({message:r,ports:n})},setMessageHandler:function(r){for(t=r;e.length>0;){var n=e.shift();t(n.message,n.ports)}}}}}}),define("platformInit/utils/biUtils",["lodash"],function(e){"use strict";return{reportBiWithWixBiSession:function(e){var t=e.reportDef,r=e.params;"undefined"!=typeof window&&(t.errorCode?window.wixBiSession.sendError(t,r.p1,r.p2,r.p3,r.p4):window.wixBiSession.sendBI(t.endpoint,t.eventId,t.src,r))},shouldUseFallbackReportBI:function(t,r){return"WIX_CODE_SITE_API"===t.intent&&"reportBI"===t.type&&e.isEmpty(r)&&"undefined"!=typeof window}}}),define("platformInit/bi/events.json",[],function(){return{WORKER_CREATED:{endpoint:"platform-viewer",src:79,eventId:101,params:{worker_id:"worker_id",ts:"ts"}},WORKER_TERMINATED:{endpoint:"platform-viewer",src:79,eventId:102,params:{worker_id:"worker_id",ts:"ts"}}}}),define("platformInit/api/wixCodeAppApi",["lodash","platformInit/utils/widgetsPreLoader","platformInit/api/workerManager","platformInit/utils/messageProxy","platformInit/utils/biUtils","platformInit/bi/events.json"],function(e,t,r,n,i,o){"use strict";function a(t){var r=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return t.rendererModel.wixCodeModel&&e.some(r,{type:"siteextension"})}return{getApi:function(){var s=n.get(),l=[],u=[],c=!1,p=!1,d=!1,f=!1,g=void 0,m=void 0;function v(e){i.shouldUseFallbackReportBI(e,l)&&i.reportBiWithWixBiSession(e),l.forEach(function(t){t(e)})}return{init:function(t,n,l,u){e.isUndefined(l.applications)&&(l.applications=[]),c?console.warn("Wix code is already initiated"):(m=l.applications.length>0,(a(t)||m)&&((g=r.getWorkerManager(t,n,function(){try{return window.localStorage.setItem("",""),window.localStorage.removeItem(""),!0}catch(e){return!1}}(),l)).initialize(v,function(e){return i.reportBiWithWixBiSession({reportDef:o.WORKER_CREATED,params:{worker_id:e,ts:Date.now()-t.wixBiSession.initialTimestamp}})},function(e){return i.reportBiWithWixBiSession({reportDef:o.WORKER_TERMINATED,params:{worker_id:e,ts:Date.now()-t.wixBiSession.initialTimestamp}})},u),s.setMessageHandler(function(e,t){return g.handleWidgetsCommand(e,t)}),c=!0))},sendMessage:function(e,t){e&&s.sendOrHoldMessage((r=e,u.reduce(function(e,t){return t(e)},r)),t);var r},registerMessageHandler:function(e){l.push(e)},registerMessageModifier:function(e){u.push(e)},unregisterMessageHandler:function(t){e.pull(l,t)},preLoadWidgets:function(e,r){!p&&a(e)&&t.asyncGetPreLoadMessage(e,r,function(e){p||(p=!0,s.sendOrHoldMessage(e))})},preLoadUserCode:function(e,r){(!d&&a(e)||m)&&t.asyncGetPreLoadUserCodeMessage(e,r,function(e){d||(d=!0,s.sendOrHoldMessage(e))})},preInitWidgets:function(e,r){!f&&a(e)&&t.asyncGetPreInitMessage(e,r,function(e){f||(f=!0,s.sendOrHoldMessage(e))})},isAppInitiated:function(){return c},getWorkerById:function(e){return g&&g.get(e)},destroyAppsContainer:function(){g&&(g.terminateStandbyWorker(),c=!1,s=n.get())}}}}}),define("platformInit/api/initMainR",["lodash","platformInit/utils/appsUtils"],function(e,t){"use strict";return function(r){var n=r.appApi,i=r.siteModel,o=r.isMobileView,a=r.queryUtil,s=r.currentUrl,l=r.isBot,u=r.fetchScripts;s=s||e.get(i,"currentUrl.full",window.document.location.href);var c=e.trimEnd(i.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/"+(a.getParameterByName("debug")?"wix.js":"wix.min.js"),p=e.trimEnd(i.serviceTopology.scriptsLocationMap["wixcode-namespaces"],"/")+"/"+(a.getParameterByName("debug")?"wixcode-namespaces.js":"wixcode-namespaces.min.js"),d=e.trimEnd(i.serviceTopology.scriptsLocationMap["wix-ui-santa"]||"https://static.parastorage.com/services/wix-ui-santa/1.1.0","/")+"/"+(a.getParameterByName("debug")?"wixcode-components.js":"wixcode-components.min.js"),f=(v=a.getParameterByName("useWixCodeFallback"),"false"!==v&&("true"===v||!window.Worker||l)),g={isMobileView:o,sdkSource:c,namespacesSdkSource:p,externalComponentsSource:d,runtimeSource:a.getParameterByName("WixCodeRuntimeSource"),useWixCodeFallback:f},m=a.getParameterByName("viewerPlatformAppSources");var v;g.applications=t.getAppsBaseInfo({rendererModel:i.rendererModel,clientSpecMap:i.rendererModel.clientSpecMap,serviceTopology:i.serviceTopology,viewerPlatformAppSources:m,santaBase:i.santaBase}),function(t){n.init(i,t,g,u),r=t,(e.some(r,{type:"siteextension"})||g.applications.length)&&(n.preLoadUserCode(i,s),i.publicModel&&n.preLoadWidgets(i,s));var r}(i.rendererModel.clientSpecMap)}}),define("platformInit",["platformInit/api/wixCodeAppApi","platformInit/api/initMainR","platformInit/utils/specMapUtils","platformInit/utils/appsUtils","platformInit/utils/widgetsPreLoader","platformInit/utils/messageProxy","platformInit/utils/biUtils"],function(e,t,r,n,i,o,a){"use strict";return{getAppApi:e.getApi,initMainR:t,specMapUtils:r,appsUtils:n,biUtils:a,widgetsPreLoader:i,registerDeps:i.registerDeps,messageProxy:o}});
//# sourceMappingURL=platformInit.min.js.map