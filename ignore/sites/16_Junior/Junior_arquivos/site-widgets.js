var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),_get=function e(t,o,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,o);if(void 0===r){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,o,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}define("site-widgets/core/SiteWidgetAspect",["lodash","widgets","coreUtils","utils","platformInit"],function(e,t,o,i,r){"use strict";var n=new WeakMap;function a(t,o){return e(t).without(i.siteConstants.MASTER_PAGE_ID).filter(o.getPageTitle.bind(o)).value()}function s(t,o,i){var r=this,a=n.get(this);if(e.includes(a.aspectProps.getAllRenderedContextIds(),o)){var s=a.siteAPI.getRuntimeDal(),p=a.siteAPI.getSiteDataAPI().document.getAllCompsUnderRoot(o,i),d=e(p).omit(["masterPage"]).mapValues(function(e){return t.call(r,s,e.id,o)}).value();a.widgetHandler.handleWidgetUpdate(d)}}return function(i){_inherits(p,t.WidgetAspect);function p(e,t,o,i,r){_classCallCheck(this,p);var a=_possibleConstructorReturn(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e,t,o,i.getRuntimeDal(),i.getActionQueue(),i.getWixCodeAppApi(),r));return n.set(a,{aspectProps:e,widgetHandler:_get(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"getWidgetHandler",a).call(a),siteAPI:i}),o.on("svSessionChange",a.updateSvSession.bind(a)),o.on("clientSpecMapUpdated",function(){var e=n.get(this);this.updateWixCodeModelDataAfterLogin(),e.widgetHandler.handleSiteMemberUpdate(e.aspectProps.getSMbySiteExtensionInstanceForRgi()),e.widgetHandler.handleAppDataUpdate(e.aspectProps.getAppsDataForRgi())}.bind(a)),o.on("displayedJsonUpdated",s.bind(a,a.getCompModel)),o.on("fakeModeChange",s.bind(a,a.getCompModel)),a}return _createClass(p,[{key:"onHostPropsChanged",value:function(e){_get(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"onHostPropsChanged",this).call(this,e);n.get(this).aspectProps=e}},{key:"loadUserCode",value:function(t){var o=n.get(this),i=o.siteAPI.getSiteData(),s=a(t,i),p=r.appsUtils.getUserCodeDefinitions(i.getClientSpecMap(),s,i);e.isEmpty(p)||o.widgetHandler.loadUserCode(p,s)}},{key:"loadAllContextsUserCode",value:function(){var t=n.get(this),i=e.without(t.aspectProps.getAllRenderedContextIds(),o.siteConstants.MASTER_PAGE_ID);this.loadUserCode(i)}},{key:"loadApps",value:function(e,t){var o=n.get(this);if(o.aspectProps.initWixCode){this.loadUserCode(o.siteAPI,e,o.widgetHandler);var i=a(e,o.siteAPI.getSiteData());_get(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"loadApps",this).call(this,i,t)}}},{key:"pageNavigationInfoChanged",value:function(e){var t=n.get(this),o=t.aspectProps.getNavigationDataForRgi();t.widgetHandler.handleLocationUpdate(o),this.removeContextIdToIgnore(e)}},{key:"updateSvSession",value:function(e){n.get(this).widgetHandler.handleSvSessionUpdate(e)}},{key:"updateWixCodeModelDataAfterLogin",value:function(){var t=n.get(this),o=_get(p.prototype.__proto__||Object.getPrototypeOf(p.prototype),"getLoadedAppsContexts",this).call(this);if(!e.isEmpty(o)){var i=e.map(o,"rootId"),a=t.siteAPI.getSiteData(),s=r.appsUtils.getApplications(a.getClientSpecMap(),i,a);t.widgetHandler.updateWixCodeModelDataAfterLogin(s,i)}}}]),p}()}),define("site-widgets",["core","site-widgets/core/SiteWidgetAspect","widgets"],function(e,t,o){"use strict";return e.behaviorHandlersFactory.registerHandler("widget",o.widgetBehaviorHandler),e.behaviorHandlersFactory.registerBehaviorPreprocessor("widget",o.widgetBehaviorPreprocessor),e.siteAspectsRegistry.registerHostLibsAspect("WidgetAspect",t),{SiteWidgetAspect:t}});
//# sourceMappingURL=site-widgets.min.js.map